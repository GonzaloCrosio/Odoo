<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========= SEARCH ========= -->
    <record id="view_dashboard_control_search" model="ir.ui.view">
        <field name="name">dashboard.control.search</field>
        <field name="model">dashboard.control</field>
        <field name="arch" type="xml">
            <search string="Dashboard Control">
                <!-- Campos buscables -->
                <field name="name"/>
                <field name="indicator"/>
                <field name="indicators_id"/>

                <!-- Filtros por nivel -->
                <separator/>
                <filter string="Red" name="lvl_red" domain="[('level', '=', '1')]"/>
                <filter string="Orange" name="lvl_orange" domain="[('level', '=', '2')]"/>
                <filter string="Yellow" name="lvl_yellow" domain="[('level', '=', '3')]"/>
                <filter string="Green" name="lvl_green" domain="[('level', '=', '4')]"/>
                <filter string="Strong Green" name="lvl_sgreen" domain="[('level', '=', '5')]"/>
                <filter string="N/A" name="lvl_na" domain="[('level', '=', '0')]"/>

                <!-- Group By (sin <group> con atributos) -->
                <separator/>
                <filter string="Group by: Indicators record" name="grp_indicators"
                        context="{'group_by':'indicators_id'}"/>
                <filter string="Group by: Indicator" name="grp_indicator"
                        context="{'group_by':'indicator'}"/>
                <filter string="Group by: Level" name="grp_level"
                        context="{'group_by':'level'}"/>
            </search>
        </field>
    </record>

    <!-- ========= List ========= -->
    <record id="view_dashboard_control_list" model="ir.ui.view">
        <field name="name">dashboard.control.list</field>
        <field name="model">dashboard.control</field>
        <field name="arch" type="xml">
            <list string="Dashboard Control" editable="bottom">
                <field name="name"/>
                <field name="indicators_id"/>
                <field name="indicator"/>
                <field name="current_value" readonly="1"/>
                <field name="level" readonly="1"/>

                <field name="higher_is_worse"/>

                <field name="v1"/>
                <field name="v2"/>
                <field name="v3"/>
                <field name="v4"/>
                <field name="v5"/>
            </list>
        </field>
    </record>


    <!-- ========= FORM ========= -->
    <record id="view_dashboard_control_form" model="ir.ui.view">
        <field name="name">dashboard.control.form</field>
        <field name="model">dashboard.control</field>
        <field name="arch" type="xml">
            <form string="Dashboard Control">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="indicators_id"/>
                            <field name="indicator"/>
                            <field name="higher_is_worse"/>
                        </group>

                        <group string="Status">
                            <field name="current_value" readonly="1"/>
                            <field name="level" readonly="1"/>
                            <field name="level_class" readonly="1"/>
                        </group>
                    </group>

                    <group string="Thresholds (5 levels)">
                        <group>
                            <field name="v1"/>
                            <field name="v2"/>
                            <field name="v3"/>
                            <field name="v4"/>
                            <field name="v5"/>
                        </group>
                        <div class="o_form_label">
                            Rule: [v1,v2) Strong Green; [v2,v3) Green; [v3,v4) Yellow; [v4,v5) Orange; &gt;=v5 Red
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>


    <!-- ========= KANBAN (Dashboard) ========= -->
    <record id="view_dashboard_control_kanban" model="ir.ui.view">
        <field name="name">dashboard.control.kanban</field>
        <field name="model">dashboard.control</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column" create="true">
                <field name="name"/>
                <field name="indicator"/>
                <field name="indicators_id"/>
                <field name="current_value"/>
                <field name="level"/>
                <field name="level_class"/>
                <field name="v1"/>
                <field name="v2"/>
                <field name="v3"/>
                <field name="v4"/>
                <field name="v5"/>
                <field name="higher_is_worse"/>

                <templates>
                    <t t-name="card">
                        <div t-attf-class="o_kanban_record oe_kanban_global_click fi_card #{record.level_class.raw_value}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                    <div class="text-muted">
                                        <field name="indicator"/>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span class="fi_dot"/>
                                    <span class="ms-1">
                                        <field name="level"/>
                                    </span>
                                </div>
                            </div>

                            <div class="mt8">
                                <div>
                                    <span class="text-muted">Current:</span>
                                    <span class="ms-1">
                                        <field name="current_value"/>
                                    </span>
                                </div>
                                <div class="text-muted mt4">
                                    <span>V1:</span>
                                    <field name="v1"/>
                                    <span class="ms-2">V2:</span>
                                    <field name="v2"/>
                                    <span class="ms-2">V3:</span>
                                    <field name="v3"/>
                                    <span class="ms-2">V4:</span>
                                    <field name="v4"/>
                                    <span class="ms-2">V5:</span>
                                    <field name="v5"/>
                                </div>
                                <div class="text-muted mt4">
                                    <span>Higher is worse:</span>
                                    <field name="higher_is_worse"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


</odoo>
